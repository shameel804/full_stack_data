{
    "id": "learn_security_csrf",
    "topicId": "csrf",
    "topicTitle": "Cross-Site Request Forgery (CSRF)",
    "description": "Master the concepts of CSRF attacks and learn how to defend your application using tokens and SameSite cookies",
    "baseKP": 90,
    "slides": [
        {
            "id": "csrf_1",
            "type": "content",
            "title": "What is CSRF?",
            "content": "# Cross-Site Request Forgery (CSRF) üé≠\n\nAn attack that forces an authenticated user to execute unwanted actions on a web application in which they're currently authenticated.\n\n- **Impact**: Changing passwords, making transfers, or deleting data without the user's consent."
        },
        {
            "id": "csrf_2",
            "type": "content",
            "title": "How CSRF Works",
            "content": "# The Implicit Trust üç™\n\nCSRF exploits the fact that browsers automatically include all cookies (including session cookies) when making a request to a domain, even if that request was triggered by a different site."
        },
        {
            "id": "csrf_3",
            "type": "content",
            "title": "An Attack Scenario",
            "content": "# The Hidden Form üïµÔ∏è\n\n1. You are logged into `bank.com`.\n2. You visit `malicious-site.com`.\n3. That site has a hidden form that POSTs to `bank.com/transfer?to=attacker&amount=1000`.\n4. Your browser sends your session cookie. The bank thinks YOU requested the transfer!"
        },
        {
            "id": "csrf_4",
            "type": "content",
            "title": "Key Requirements for CSRF",
            "content": "# Vulnerability Checklist ‚úÖ\n\n- A **Relevant Action**: Something on the site an attacker would want to trigger (e.g., Delete Account).\n- **Cookie-based Session**: The site uses cookies to identify the user.\n- **No Unpredictable Parameters**: The request only uses parameters the attacker can guess (like user ID or amount)."
        },
        {
            "id": "csrf_5",
            "quizQuestion": "What is the primary mechanism CSRF exploits to impersonate a user?",
            "quizOptions": [
                "Stolen Passwords",
                "Browser's automatic inclusion of cookies",
                "Weak encryption",
                "Malware on the server"
            ],
            "correctOptionIndex": 1,
            "type": "quiz",
            "title": "Mechanism Quiz",
            "content": "Understanding the flaw."
        },
        {
            "id": "csrf_6",
            "type": "content",
            "title": "Defense: CSRF Tokens",
            "content": "# The Anti-Forgery Token üõ°Ô∏è\n\nA unique, secret, and unpredictable token generated by the server for each session/request.\n\n- **Logic**: The server expects this token in every POST/PUT request. Since an attacker on another site can't read the token (due to SOP), they can't forge a valid request!"
        },
        {
            "id": "csrf_7",
            "type": "content",
            "title": "Token Implementation",
            "content": "# Double Check üîç\n\n1. Server sends token in a hidden HTML field.\n2. Client sends it back in the request body/header.\n3. Server verifies: `session_token === request_token`."
        },
        {
            "id": "csrf_8",
            "type": "content",
            "title": "Defense: SameSite Cookie Attribute",
            "content": "# Modern Protection üç™‚ú®\n\nA cookie attribute that tells the browser whether to send cookies with cross-site requests.\n\n- `Strict`: Never send on cross-site requests.\n- `Lax`: Default. Only send for \"safe\" top-level navigations (like clicking a link).\n- `None`: Always send (Requires `Secure`)."
        },
        {
            "id": "csrf_9",
            "type": "content",
            "title": "Custom Request Headers",
            "content": "# Implicit Protection üõ°Ô∏è\n\nAJAX requests that add custom headers (like `X-Requested-With`) are inherently protected against CSRF because browsers require a **CORS preflight** for custom headers, which the attacker won't pass."
        },
        {
            "id": "csrf_10",
            "quizQuestion": "Which SameSite attribute value provides the highest level of protection against CSRF?",
            "quizOptions": [
                "Lax",
                "None",
                "Strict",
                "All"
            ],
            "correctOptionIndex": 2,
            "type": "quiz",
            "title": "Cookie Quiz",
            "content": "SameSite options."
        },
        {
            "id": "csrf_11",
            "type": "content",
            "title": "GET is for Reading",
            "content": "# Idempotency üõë\n\nNever perform state-changing actions (Delete, Update) via GET requests. GET requests are easily triggered via `<img>` tags or simple links, making them extremely vulnerable to CSRF."
        },
        {
            "id": "csrf_12",
            "type": "content",
            "title": "Double Submit Cookies",
            "content": "# Stateless Patterns ‚òÅÔ∏è\n\nA CSRF defense where the token is sent in both a cookie and a request parameter. The server checks if they match without needing to store the token in the session."
        },
        {
            "id": "csrf_13",
            "type": "content",
            "title": "Verifying Referer Header",
            "content": "# Origin Check üåê\n\nChecking `Referer` or `Origin` headers to ensure the request came from your own domain. \n\n> ‚ö†Ô∏è Use this as a secondary check, as these headers can sometimes be spoofed or stripped for privacy."
        },
        {
            "id": "csrf_14",
            "type": "content",
            "title": "XSS + CSRF",
            "content": "# The Ultimate Combo üí•\n\nIf you have XSS, CSRF protections (like tokens) can be bypassed because the attacker can use JS to read the token from the DOM! \n\n> üí° Always fix XSS first."
        },
        {
            "id": "csrf_15",
            "quizQuestion": "Why is it dangerous to use GET requests for actions like 'delete_user'?",
            "quizOptions": [
                "GET requests are too slow",
                "GET requests are automatically cached",
                "GET requests can be triggered by simple HTML tags like <img> or <a> without JS",
                "GET requests don't support cookies"
            ],
            "correctOptionIndex": 2,
            "type": "quiz",
            "title": "HTTP Methods Quiz",
            "content": "Safe methods."
        },
        {
            "id": "csrf_16",
            "type": "content",
            "title": "Mobile Apps & CSRF",
            "content": "# App Security üì±\n\nMobile apps that use JWTs in the `Authorization` header instead of cookies are naturally immune to CSRF, as browsers don't automatically include custom headers in cross-site requests."
        },
        {
            "id": "csrf_17",
            "type": "content",
            "title": "Logout CSRF",
            "content": "# Minor Nuisance üö™\n\nAttackers can logout users from sites by triggering a CSRF request to `/logout`. While not usually critical, it can be a significant annoyance."
        },
        {
            "id": "csrf_18",
            "type": "content",
            "title": "Framework Support",
            "content": "# Automate Defense üèóÔ∏è\n\nFrameworks like Django, Rails, and Spring Boot have built-in CSRF protection enabled by default. **Don't turn it off!**"
        },
        {
            "id": "csrf_19",
            "type": "content",
            "title": "CSRF in APIs",
            "content": "# Beyond the Browser üì¶\n\nIf your API is intended for browser-based clients (using cookies), you still need CSRF protection. If it's solely for mobile/M2M using tokens, you are likely safe."
        },
        {
            "id": "csrf_20",
            "quizQuestion": "True or False: Using JWTs in an 'Authorization' header makes an API mostly immune to traditional CSRF.",
            "quizOptions": [
                "True",
                "False"
            ],
            "correctOptionIndex": 0,
            "type": "quiz",
            "title": "Final Quiz",
            "content": "Modern patterns."
        },
        {
            "id": "csrf_21",
            "type": "content",
            "title": "Summary",
            "content": "# Summary üéâ\n\n- ‚úÖ Use **CSRF Tokens** for state-changing actions.\n- ‚úÖ Use **SameSite=Lax** or **Strict** for cookies.\n- ‚úÖ Never use **GET** for sensitive actions.\n- ‚úÖ Prefer custom headers for AJAX requests.\n- ‚úÖ Fix XSS to prevent token leakage.\n\nProtect your users from forged requests! üõ°Ô∏è"
        }
    ]
}